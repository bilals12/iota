default_stages: [commit]

repos:
  # Common hooks for all file types
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: check-json
      - id: check-yaml
      - id: end-of-file-fixer
      - id: trailing-whitespace
        exclude: |
          (?x)^(
            sync-environment.patch
          )$

  # Prettier for formatting
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v3.1.0
    hooks:
      - id: prettier
        stages: [pre-commit]
        # Exclude docs generated by go-markdoc
        exclude: '^(?:[^/]+/)+[^/]+\.md$'

  # Commitlint for commit messages
  - repo: https://github.com/alessandrojcm/commitlint-pre-commit-hook
    rev: v9.23.0
    hooks:
      - id: commitlint
        fail_fast: true
        language_version: system
        stages: [commit-msg]
        additional_dependencies: ["@open-turo/commitlint-config-conventional"]

  # GitHub Actions linting
  - repo: https://github.com/rhysd/actionlint
    rev: v1.7.8
    hooks:
      - id: actionlint
        fail_fast: true

  # Shell script linting
  - repo: https://github.com/jumanjihouse/pre-commit-hooks
    rev: 3.0.0
    hooks:
      - id: shellcheck
        fail_fast: true
      - id: shfmt

  # Python-specific hooks
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.8.4
    hooks:
      - id: ruff
        types_or: [python, pyi]
      - id: ruff-format
        types_or: [python, pyi]

  # Go-specific hooks
  - repo: https://github.com/turo/pre-commit-hooks
    rev: v4.0.0
    hooks:
      - id: go-mod-tidy
        fail_fast: true
      - id: go-build
        fail_fast: true
      - id: go-test-unit
      - id: docker-lint
      - id: docker-compose-lint

  # Official golangci-lint hook
  - repo: https://github.com/golangci/golangci-lint
    rev: v1.62.2
    hooks:
      - id: golangci-lint
        fail_fast: true

  # Terraform/HCL-specific hooks
  - repo: https://github.com/antonbabenko/pre-commit-terraform
    rev: v1.103.0
    hooks:
      - id: terraform_fmt
        stages: [pre-commit]

  - repo: https://github.com/open-turo/standards-terraform
    rev: v1.4.2
    hooks:
      - id: vars-in-variables-files
        fail_fast: true
      - id: outputs-in-outputs-files
        fail_fast: true
      - id: provider-pinned-versions
        fail_fast: true

  # Kubernetes manifest validation
  - repo: https://github.com/Agilicus/pre-commit-hook-k8svalidate
    rev: v0.2.0
    hooks:
      - id: k8svalidate
        fail_fast: true
        args:
          ["--exclude", "**/*.patch.yaml", "--exclude", "**/k8s.nginx*.yaml"]
        files: .yaml$
        exclude: '^.*((install)|(\.patch)|(k8s\.nginx\..*))\.yaml$'
